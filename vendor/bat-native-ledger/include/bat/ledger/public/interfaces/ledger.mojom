// This Source Code Form is subject to the terms of the Mozilla Public
// License, v. 2.0. If a copy of the MPL was not distributed with this file,
// You can obtain one at http://mozilla.org/MPL/2.0/.
module bat_ledger.mojom;

union DataStoreValue {
  string string_value;
  int32 int_value;
  int64 int64_value;
  double double_value;
  bool bool_value;
};

struct DataStoreCommandBinding {
  int32 index;
  DataStoreValue value;
};

struct DataStoreTransaction {
  array<DataStoreCommand> commands;
};

struct DataStoreCommand {
  enum Type {
    INITIALIZE,
    CREATE,
    READ,
    UPDATE,
    DELETE,
    MIGRATE
  };
  Type type;
  string command;
  int32 compatible_version;
  int32 version;
  array<DataStoreCommandBinding> bindings;
  array<DataStoreRecordBinding> record_bindings;
};

struct DataStoreRecordBinding {
  enum Type {
    STRING_TYPE,
    INT_TYPE,
    INT64_TYPE,
    DOUBLE_TYPE,
    BOOL_TYPE
  };
  Type type;
};

struct DataStoreRecord {
  array<DataStoreValue> fields;
};

union DataStoreCommandResult {
  array<DataStoreRecord> records;
  DataStoreValue value;
};

struct DataStoreCommandResponse {
  enum Status {
    OK,
    INITIALIZATION_ERROR,
    TRANSACTION_ERROR,
    COMMAND_ERROR,
    ERROR
  };
  DataStoreCommandResult result;
  Status status;
};
